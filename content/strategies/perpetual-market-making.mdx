---
title: Perpetual Market Making
description: Learn how to use Perpetual market making strategy
---

import Callout from "../../src/components/Callout";
import Prompt from "../../src/components/Prompt";


## How It Works

Perpetual market making allows Hummingbot users to market make on supported derivatives exchanges. Position management features are introduced to configure the bot further to make managing positions easier and remove the need to interact with the derivative exchange manually.

Similar to pure market making strategy, it keeps placing limit buy and sell orders on the order book and waits for other participants (takers) to fill its orders.

In this document, we will explain how the strategy works by dividing it into three main behaviors:

1. Creating orders to open a position
2. Opening positions after a filled order event
3. Creating orders to close a position

You can also watch the recording of our demo of the strategy in the link below:

- [Hummingbot Live - Perpetual Market Making Demo](https://www.youtube.com/watch?v=IclhZWtKiSA&t=2194s)

<Callout
  type="info"
  body="Currently, this strategy `only works with Binance Futures` and we plan to support more derivatives connector in the future."
/>


## Testing The Strategy

Users can test how this strategy works without risking real funds by connecting their Binance Futures Testnet account to Hummingbot.

- [Create a free account with Binance Futures Testnet](https://testnet.binancefuture.com/en/register?source=futures)
- [Creating Binance Futures Testnet API Keys](https://docs.hummingbot.io/exchange-connectors/binance-futures/#creating-binance-futures-testnet-api-keys)


## Creating a basic strategy configuration

1. Make sure to connect to an exchange supported by Perpetual Market Making strategy.
- [How to use the `connect` command to connect your API keys](/operation/command-ref/#connect)
2. Run the `create` command and enter `perpetual_market_making` when prompted for the strategy you want to use
3. Enter the name of the connector and the trading pair you want to use with this strategy
4. Enter how much [`leverage`](#leverage) you want to use. Leverage allows you to open a position with a fraction of a cost. The higher the leverage, the higher the risk. Please manage accordingly.
5. Select a [`position_mode`](#position_mode) from either One-way or Hedge mode. These are both explained further in their respective sections below.
6. Enter the amount of orders you want to place in `order_amount` prompt
7. Select a `position_management` from either `Profit_taking` or `Trailing_stop` value
8. If you selected `Profit_taking`, enter the spreads of your profit taking orders to close a long or short position in `long_profit_taking_spread` `short_profit_taking_spread`
9. If you selected `Trailing_stop`, enter the spread when you want the bot to start trailing as `ts_activation_spread` and the exit price as `ts_callback_rate`
10. Enter the spread from entry price to close a position with a stop loss order
11. Choose between limit or market order when `close_position_order_type` value for stop loss and trailing stop orders
12. The strategy configuration file is saved in the Hummingbot folder
- [Where are my configuration files saved?](https://hummingbot.zendesk.com/hc/en-us/articles/900005206343-Where-is-my-config-and-log-file-)


## Creating orders to open a position

Initially, a limit buy and sell order are created based on `bid_spread` and `ask_spread` settings. This determines the entry price of the position we will open later.

**What happens if both my orders are not filled?**

If the orders are not filled when they reach `order_refresh_time`, they are cancelled and a new set of orders are created to ensure our orders are refreshed based on our specified bid/ask spread.

With the exception of `order_refresh_tolerance_pct` value, if the orders are within the tolerable change in spread then they are not cancelled. A log message on the right pane will show “Not cancelling active orders since difference between the new order prices and current order prices is within order_refresh_tolerance_pct”.

**If one of my orders is filled, what happens to the opposite order that was not filled?**

In `One-way` mode, if an order is filled the opposite order is cancelled. For example, if your buy order is filled it opens a LONG position, cancels the opening sell order and creates a closing sell order.

In `Hedge` mode, if one order is filled the opposite order is not cancelled. For example, if your buy order is filled it opens a LONG position and creates another closing sell order. The opening sell order that was initially created remains active waiting to get filled so it can open a SHORT position simultaneously.


## Opening positions after a filled order event
The strategy uses the filled order’s price as the entry price of the position. The number of positions you can open depends on the `position_mode` selected:
- `One-way` mode - only one position can be opened i.e. you only have either a LONG or a SHORT position.
- `Hedge` mode - two positions can be opened simultaneously i.e. you can have one LONG and one SHORT position.




## `leverage`

Enter the leverage you would like to use.

** Prompt: **

<Prompt
  prompt="How much leverage do you want to use? (Binance Perpetual supports up to 75X for most pairs) >>>"
  response=">>> "
/>

## `position_mode`

Generally, the Perpetual market making strategy can manage two different types of position modes :

<Callout
  type="note"
  body="Some perpetual connectors may offer either of the modes or both."
/>

** Prompt: **

<Prompt
  prompt="Which position mode do you want to use? (One-way/Hedge) >>>"
  response=">>> Hedge"
/>
<br />

### `One-way`

In this mode, only one active position(long or short) per trading pair is possible. Trying to open a second position would increase or decrease the position’s size depending on the second position’s side.

In `One-way` mode, users can have only one active position in the direction of the order that opened the contract regardless of the `position_management` being used. Refer to the example below:

```
position_mode: One-way
bid_spread: 0.01
ask_spread: 0.01
order_refresh_time: 30
position_management: Profit_taking
```

![](/img/oneway.png)

### `Hedge`

Unlike one-way mode, it is possible to have a long and short position open concurrently without affecting the size of the contract.

In `Hedge` mode, users can have two open positions.

```
position_mode: Hedge
bid_spread: 0.01
ask_spread: 0.01
order_refresh_time: 30
position_management: Profit_taking
```

View the image here that if one order gets filled, it will close the long position. If the other order gets filled, it will open a short position.

![](/img/open-orders1.png)

![](/img/positions.png)

## `order_amount`

The order amount for the short or long position of the base asset for the trading pair.

** Prompt: **

<Prompt prompt="What is the amount of [trading pair] per order? >>> 3" />

## `position_management`

Two available features for position management. `Profit_taking` and `Trailing_stop` are the currently available features.

** Prompt: **

<Prompt
  prompt="How would you like to manage your positions? (Profit_taking/Trailing_stop) >>>"
  response=">>> Profit_taking"
/>

### `Profit_taking`

Places a short or long order to close a position from the position's entry price determined by the spreads set. After an order is filled, a position is opened immediately. The parameters under Profit taking are `long_profit_taking_spread` and `short_profit_taking_spread`.

<br />

`long_profit_taking_spread`

It is the spread above the entry price at which a short limit order is placed to close the position.

** Prompt: **

<Prompt
  prompt="At what spread from the entry price do you want to place a short order to reduce position? (Enter 1 for 1%) >>>"
  response=">>> 1"
/>

`short_profit_taking_spread`

It is the spread below the entry price at which a long limit order is placed to close the position.

** Prompt: **

<Prompt
  prompt="At what spread from the entry price do you want to place a long order to reduce position? (Enter 1 for 1%) >>>"
  response=">>> 1"
/>

Refer to the example below.

```
position_mode: Hedge
bid_spread: 0.01
ask_spread: 0.01
order_refresh_time: 30
position_management: Profit_taking
long_profit_taking_spread: 0.5%
short_profit_taking_spread: 0.5%

```

A position is immediately opened when an order is filled.

![](/img/open-position.png)

After the position has been opened, it will create an order to take profit(and close position) provided there's no open loss on the active position.

![](/img/open-orders2.png)

If by chance, the order for `open long` gets filled, it will now open a long position, and you now have two open orders to close the positions.

![](/img/profit-taking-hedge.png)

The bot will create orders depending on the `long_profit_taking_spread` and `short_profit_taking_spread` that is set. The position will be closed once the orders are filled, depending on the spreads.

![](/img/close-positions.png)

### `Trailing_stop`

Trailing would begin if the current price is beyond or equal to the set `ts_activation_spread`. Setting this parameter to zero would start the trailing immediately the position is opened.

`ts_activation_spread`

Traders can fill in the price level that triggers the trailing stop. If no activation price is being filled, the activation price will be the position entry price by default.

** Prompt: **

<Prompt
  prompt="At what spread from the position entry price do you want the bot to start trailing? (Enter 1 for 1%) >>>"
  response=">>> 1"
/>

`ts_callback_rate`

Callback rate determines the price away from peak maximum or peak minimum price when trailing, beyond which a long position or short position will be closed respectively.

** Prompt: **

<Prompt
  prompt="At what spread away from the trailing peak price do you want positions to remain open before they're closed? (Enter 1 for 1%) >>>"
  response=">>> 1"
/>

`close_position_order_type`

This feature gives users the option to select the order type for closing positions which is used by the trailing stop and/or stop loss features.

** Prompt: **

<Prompt
  prompt="What order type do you want to use for closing positions? (LIMIT/MARKET) >>>"
  response=">>> LIMIT"
/>

![](/img/trailing-stop-explanation.png)

Source: https://www.binance.com/en/support/faq/360042299292

Refer to the example below.

```
position_mode: Hedge
bid_spread: 0.01
ask_spread: 0.01
order_refresh_time: 30
position_management: Trailing_stop
ts_activation_spread: 0.01%
ts_callback_rate: 0.5%
close_position_order_type: LIMIT

```

The order was filled, but the position was immediately closed because the current price was above or not equal to `ts_activation_spread`.

![](/img/trailing-stop.png)

Trailing began when the `ts_activation_spread` was met, then the position eventually closed because it reached the percentage we set as `ts_callback_rate`.

![](/img/callback-rate.png)

## `stop_loss_spread`

`Stop_loss` works with both `Profit_taking` and `Trailing_stop` features and would only place a stop loss order if loss has reached the limit set by the stop loss spread.

** Prompt: **

<Prompt
  prompt="At what spread from position entry price do you want to place stop_loss order? (Enter 1 for 1%) >>>"
  response=">>> 1"
/>

### stop_loss_spread with `Profit_taking`

A profit taking order would be placed immediately if the position has no opening loss, otherwise, it would monitor position and place a stop-loss order if loss increases to the set stop-loss spread. If a loss is detected, the `Profit_taking` orders will be canceled, and a stop-loss order will be placed if loss rises to the set stop-loss spread.

Suppose stop-loss spread is set too low and LIMIT order is specified to close the position in an active market. In that case, there's a high probability that the take profit feature would cancel and replace a stop-loss order.

### stop_loss_spread with `Trailing_stop`

Once a profitable exit price is detected, no stop-loss order should be placed. An exception could arise in cases where the market swings swiftly to an unprofitable price within ticks or if the configured trailing stop parameters are too low.

If no exit price has been detected, a stop-loss order will be placed if loss increases to the set stop-loss spread.

![](/img/no-exit-price2.png)

<Callout
  type="info"
  body="Price `NILL` means the market is yet to move enough to have a peak price that'll give a profitable exit price according to the configured parameters for the feature."
/>
